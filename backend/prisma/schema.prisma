datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "go run github.com/steebchen/prisma-client-go"
  output   = "./path/to/generated/client"
}

// role user
enum Role {
  SUPER_ADMIN
  ADMIN
  ASISTEN
  PRAKTIKAN
}

// user
model User {
  id        String    @id @unique @default(dbgenerated("gen_random_uuid()")) @db.VarChar(100)
  nrp       String
  name      String
  password  String
  role      Role
  createdAt DateTime? @default(now()) @map("created_at")
  updatedAt DateTime? @updatedAt @map("updated_at")

  // Relasi untuk asisten ke kelompok
  asistantGroups Group[] @relation("AsistantGroups")

  // Relasi untuk anggota kelompok
  memberGroups Group[] @relation("MemberGroups")

  // Relasi untuk asisten yang memberi nilai
  gradedGrades Grade[] @relation("GradedBy")

  // Relasi untuk praktikan yang menerima nilai
  userGrades Grade[] @relation("UserGrades")

  // Relasi ke jadwal asisten
  asistantSchedules Schedule[] @relation("AsistantSchedules")

  // Relasi ke pengumuman yang dibuat
  announcements Announcement[]
}

// kelompok
model Group {
  groupId     String @id @unique @default(dbgenerated("gen_random_uuid()")) @db.VarChar(100)
  name        Int    @db.SmallInt
  practicumId Int
  asistantId  String

  // Relasi ke Practicum
  practicum Practicum @relation("PracticumGroups", fields: [practicumId], references: [id])

  // Relasi ke User (asisten)
  asistant User @relation("AsistantGroups", fields: [asistantId], references: [id])

  // Relasi ke User (anggota kelompok)
  members User[] @relation("MemberGroups")

  // Relasi ke Schedule (jadwal praktikum)
  schedules Schedule[] @relation("GroupSchedules")

  @@index([practicumId])
  @@index([asistantId])
}

// praktikum
model Practicum {
  id          Int      @id @default(autoincrement())
  title       String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relasi ke Group
  groups Group[] @relation("PracticumGroups")

  // Relasi ke Schedule
  schedules Schedule[]

  @@map("practicums")
}

// jadwal
model Schedule {
  id          Int      @id @default(autoincrement())
  practicumId Int
  groupId     String
  asistantId  String
  date        DateTime
  startTime   DateTime
  status      Status   @default(SCHEDULED)

  practicum Practicum @relation(fields: [practicumId], references: [id])
  group     Group     @relation("GroupSchedules", fields: [groupId], references: [groupId])
  asistant  User      @relation("AsistantSchedules", fields: [asistantId], references: [id])

  grades Grade[]

  @@unique([groupId, startTime])
}

// penilaian
model Grade {
  id           Int      @id @default(autoincrement())
  scheduleId   Int
  userId       String
  prelab       Int?     @db.SmallInt
  inlab        Int?     @db.SmallInt
  abstract     Int?     @db.SmallInt
  introduction Int?     @db.SmallInt
  methodology  Int?     @db.SmallInt
  discussion   Int?     @db.SmallInt
  conclusion   Int?     @db.SmallInt
  formatting   Int?     @db.SmallInt
  feedback     String?
  gradedBy     String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  schedule Schedule @relation(fields: [scheduleId], references: [id])
  user     User     @relation("UserGrades", fields: [userId], references: [id])
  grader   User     @relation("GradedBy", fields: [gradedBy], references: [id])
}

// status praktikum yang diambil
enum Status {
  SCHEDULED
  COMPLETED
  CANCELLED
}

model Announcement {
  id          Int      @id @default(autoincrement())
  title       String   @db.VarChar(200)
  content     String   @db.Text
  authorId    String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  isPublished Boolean  @default(false)

  author User @relation(fields: [authorId], references: [id])

  @@index([createdAt])
}
